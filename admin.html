<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin Dashboard â€” Task Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Inter,system-ui; padding:18px; background:#f6f8fb}
    .card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 6px 20px rgba(12,18,30,0.06);margin-bottom:14px}
    h2{margin:0 0 12px 0;font-size:18px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1;min-width:280px}
  </style>
</head>
<body>
  <h1>Admin Dashboard</h1>
  <div class="row">
    <div class="col card">
      <h2>Tasks per day (14 days)</h2>
      <canvas id="chartDays"></canvas>
    </div>
    <div class="col card">
      <h2>Tasks by employee</h2>
      <canvas id="chartEmployees"></canvas>
    </div>
    <div class="col card">
      <h2>Status distribution</h2>
      <canvas id="chartStatus"></canvas>
    </div>
  </div>

<script>
const API = (path)=> {
  // adjust if server is on different origin (e.g. http://localhost:4000)
  const base = window.__API_BASE__ || '';
  return fetch(base + '/api' + path).then(r=>r.json());
};

function renderCharts(){
  API('/stats/tasks-per-day?days=14').then(rows=>{
    const labels = rows.map(r=>r.day);
    const data = rows.map(r=>r.cnt);
    new Chart(document.getElementById('chartDays'), {
      type:'bar',
      data:{labels, datasets:[{label:'Tasks', data}]},
      options:{responsive:true, plugins:{legend:{display:false}}}
    });
  });

  API('/stats/tasks-per-employee').then(rows=>{
    const labels = rows.map(r=>r.name);
    const data = rows.map(r=>r.cnt);
    new Chart(document.getElementById('chartEmployees'), {
      type:'bar',
      data:{labels, datasets:[{label:'Tasks', data}]},
      options:{indexAxis:'y', responsive:true, plugins:{legend:{display:false}}}
    });
  });

  API('/stats/status-distribution').then(rows=>{
    const labels = rows.map(r=>r.status);
    const data = rows.map(r=>r.cnt);
    new Chart(document.getElementById('chartStatus'), {
      type:'doughnut',
      data:{labels, datasets:[{label:'Status', data}]},
      options:{responsive:true}
    });
  });
}

renderCharts();
</script>
</body>
</html>
